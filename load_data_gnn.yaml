name: Load New Elliptic Bitcoin Dataset
description: 2 Loads the EllipticBitcoinDataset and saves it as a PyTorch .pt file.
outputs:
  - name: outputpath1
    type: String
    description: Path to saved dataset file (.pt)
implementation:
  container:
    image: python:3.9
    command:
      - sh
      - -c
      - |
        # Install dependencies
        PIP_DISABLE_PIP_VERSION_CHECK=1 python3 -m pip install --quiet torch torchvision torchaudio --user
        PIP_DISABLE_PIP_VERSION_CHECK=1 python3 -m pip install --quiet torch_geometric pandas --user
        
        # Create output directory
        mkdir -p /tmp/outputs/outputpath1
        
        # Run Python script with proper argument passing
        python3 -u - --outputpath1 "$0" <<'PYCODE'
        import argparse
        import os
        import sys
        import torch
        from torch_geometric.datasets import EllipticBitcoinDataset
        
        parser = argparse.ArgumentParser()
        parser.add_argument('--outputpath1', type=str, required=True)
        args = parser.parse_args()
        
        print(f"[INFO] Output path received: {args.outputpath1}")
        
        
        
        dataset = EllipticBitcoinDataset(root='/tmp/elliptic')
        data = dataset[0]
        
        torch.save(data, '/tmp/outputs/outputpath1/data')
        print(f"[SUCCESS] Saved raw data to /tmp/outputs/outputpath1/data")
        
        
        # # Write the dataset path to the Kubeflow output location
        # with open('/tmp/outputs/outputpath1/data', 'w') as f:
        #     f.write(dataset_path)
        # print(f"[INFO] Output path written to /tmp/outputs/outputpath1/data")
        PYCODE
    args:
      - {outputPath: outputpath1}
